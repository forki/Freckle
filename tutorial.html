<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Understanding Functional Reactive Programming
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="A Functional Reactive Programming Library for FSharp"/>
    <meta name="author" content="Jannick Johnsen"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/Freckle/content/style.css" />
    <script type="text/javascript" src="/Freckle/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/jannickj/Freckle">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/Freckle/index.html">Freckle</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Understanding-Functional-Reactive-Programming" class="anchor" href="#Understanding-Functional-Reactive-Programming">Understanding Functional Reactive Programming</a></h1>
<p>Functional Reactive Programming (or short FRP), is often mired in abstract languge and theoretical functional programming lingo.
In this tutorial we will attempt to keep it simple and easy to follow.</p>
<p>To begin with lets define FRP.
In order for something to be classified as frp it must be:</p>
<ul>
<li>Composable and Declarative (i.e. functional)</li>
<li>Reactive</li>
<li>Sampling Resolution Oblivious</li>
</ul>
<p>The first two requirements are fairly easy to understand, i.e. of course it must be functional and be able to react to events occuring in the system.
However the 3. requirement <strong>Sampling Resolution Oblivious</strong>, requires that we understand what sampling resolution is.</p>
<p>In short the sampling resolution is analogous to the the span of time between each sample, in video games this is often refered to as the tick rate.</p>
<p>However let us see how this problem plays out in an actual application.
Imagine we have the following program</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">while</span> <span class="k">true</span> <span class="k">do</span>
    <span onmouseout="hideTip(event, 'fs1', 19)" onmouseover="showTip(event, 'fs1', 19)" class="f">update</span> ()
</code></pre></td>
</tr>
</table>
<p>This program updates its state and nothing more, the sampling resolution of this program depends entirely on computer running it and how costly the function <code>update</code> is.
If we assume that it always takes 16 ms to execute <code>update</code> then we get a sampling resolution at</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="n">1000</span> <span class="o">/</span> <span class="n">16</span> <span class="i">ms</span> <span class="k">~</span> <span class="n">60</span> <span class="i">ticks</span> <span class="i">per</span> <span class="i">seconds</span>
</code></pre></td>
</tr>
</table>
<p>Meaning that update is called about 60 times per seconds.</p>
<p>However as is obvious there is no guarantees given that <code>update</code> will take exactly 16 ms to execute. Which might problem if an application needs to update at precise interval,
old programs have sometimes ignored thus when running them on modern computers they have completely stopped functioning properly.</p>
<p>The next naive solution to account for a fixed sampling rate would be to delay the update difference. e.g.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 20)" onmouseover="showTip(event, 'fs10', 20)" class="i">desiredDelay</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 21)" onmouseover="showTip(event, 'fs6', 21)" class="f">time</span> <span class="n">16</span>

<span class="k">while</span> <span class="k">true</span> <span class="k">do</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 22)" onmouseover="showTip(event, 'fs11', 22)" class="i">startTime</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 23)" onmouseover="showTip(event, 'fs5', 23)" class="f">now</span> ()
    <span onmouseout="hideTip(event, 'fs1', 24)" onmouseover="showTip(event, 'fs1', 24)" class="f">update</span> ()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 25)" onmouseover="showTip(event, 'fs12', 25)" class="i">diffTime</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 26)" onmouseover="showTip(event, 'fs5', 26)" class="f">now</span> () <span class="o">-</span> <span onmouseout="hideTip(event, 'fs11', 27)" onmouseover="showTip(event, 'fs11', 27)" class="i">startTime</span>
    <span onmouseout="hideTip(event, 'fs7', 28)" onmouseover="showTip(event, 'fs7', 28)" class="f">wait</span> (<span onmouseout="hideTip(event, 'fs10', 29)" onmouseover="showTip(event, 'fs10', 29)" class="i">desiredDelay</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs12', 30)" onmouseover="showTip(event, 'fs12', 30)" class="i">diffTime</span>)
</code></pre></td>
</tr>
</table>
<p>Initially this provides us with what we required, the program operates consistently at a fixed sampling rate.
However as you can probably already observe, if for any reason at any point during the life time of the program, <code>update</code> takes longer than expected.
Meaning that <code>diffTime &gt; desiredDelay</code> i.e. requring us to wait negative, then the program will become out of sync forever.
If it was because the <code>desiredDelay</code> was set shorter than update is in average, then there is nothing we can do.</p>
<p>This is because the resolution of the program is too low to support it, much like if we have a picture with a bad resolution we try to show on a large screen, that too will prevent anything meaningful.
However if in average <code>update</code> is far below the <code>desiredDelay</code> but once in a while goes over <code>desiredDelay</code>, then we essentially skip certain important computations.
e.g. imagine a program simulating a car but with the expectation that an <code>updateCar</code> function is called 10 times a second, then skipping a couple of calculations can have a huge impact on the result.</p>
<p>To solve this problem let us propose the next naive solution</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">while</span> <span class="k">true</span> <span class="k">do</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 31)" onmouseover="showTip(event, 'fs11', 31)" class="i">startTime</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 32)" onmouseover="showTip(event, 'fs5', 32)" class="f">now</span> ()
    <span class="k">if</span> <span class="i">lastDiff</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">then</span>
        <span onmouseout="hideTip(event, 'fs1', 33)" onmouseover="showTip(event, 'fs1', 33)" class="f">update</span> ()
    <span onmouseout="hideTip(event, 'fs1', 34)" onmouseover="showTip(event, 'fs1', 34)" class="f">update</span> ()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 35)" onmouseover="showTip(event, 'fs12', 35)" class="i">diffTime</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 36)" onmouseover="showTip(event, 'fs5', 36)" class="f">now</span> () <span class="o">-</span> <span onmouseout="hideTip(event, 'fs11', 37)" onmouseover="showTip(event, 'fs11', 37)" class="i">startTime</span>
    <span onmouseout="hideTip(event, 'fs7', 38)" onmouseover="showTip(event, 'fs7', 38)" class="f">wait</span> (<span onmouseout="hideTip(event, 'fs10', 39)" onmouseover="showTip(event, 'fs10', 39)" class="i">desiredDelay</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs12', 40)" onmouseover="showTip(event, 'fs12', 40)" class="i">diffTime</span>)
</code></pre></td>
</tr>
</table>
<p>This solution solves the problem by calling <code>update</code> an extra time in the event it becomes out of sync.
So job done? Not quite... because depending on how long a single execution takes it might still cause update to become out of sync.</p>
<p>Imagine that <code>update</code> was for a graphical application and looked something like this:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 41)" onmouseover="showTip(event, 'fs1', 41)" class="f">update</span> () <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 42)" onmouseover="showTip(event, 'fs13', 42)" class="i">state</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 43)" onmouseover="showTip(event, 'fs8', 43)" class="f">updateState</span>() <span class="c">//Fairly fast state update</span>
    <span onmouseout="hideTip(event, 'fs9', 44)" onmouseover="showTip(event, 'fs9', 44)" class="f">render</span> <span onmouseout="hideTip(event, 'fs13', 45)" onmouseover="showTip(event, 'fs13', 45)" class="i">state</span>              <span class="c">//Expensive graphic render function</span>
</code></pre></td>
</tr>
</table>
<p>As you might imagine rendering two times in a row doesn't change anything from an application perspective, however it is a huge drain on the resources of the cpu.
So what we in reality want is something that allows us to define that if we miss an <code>updateState</code> but if we miss a <code>render</code> then that should just be skipped.</p>
<p>Before we move onto how frp would handle these problems, let's highlight one thing that has been overlooked so far.</p>
<p>Remember the <strong>Oblivious</strong> in Sampling Resolution Oblivious, thus far the proposed solutions have completely overlooked this aspect.
All we have achieved is uniform(kinda..) sampling however consider what would happen if we changed the <code>desiredDelay</code> to half its current value.</p>
<p>Essentially this would mean <code>update</code> is called twice as many times, or in other words the application is <strong>Sampling Resolution Sensitive</strong>.
However if we consider all the prior problems they have all been the victim of some form of Sampling Resolution Sensitivity.
This is why <strong>Sampling Resolution Obliviousity</strong> is and must be a property of FRP.</p>
<p>So far the problems we have shown are</p>
<ol>
<li>Unpredictable Sampling</li>
<li>Single samplings causing out of sync</li>
<li>Redudant sampling</li>
<li>The root to all of these being <strong>Sampling Resolution Sensitivity</strong></li>
</ol>
<h1><a name="Understanding-Functional-Reactive-Programming-1" class="anchor" href="#Understanding-Functional-Reactive-Programming-1">Understanding Functional Reactive Programming</a></h1>

<div class="tip" id="fs1">val update : unit -&gt; unit<br /><br />Full name: Tutorial.update</div>
<div class="tip" id="fs2">Multiple items<br />union case Time.Time: unit -&gt; Time<br /><br />--------------------<br />type Time =<br />&#160;&#160;| Time of unit<br />&#160;&#160;static member ( - ) : &#39;a * &#39;b -&gt; Time<br /><br />Full name: Tutorial.Time</div>
<div class="tip" id="fs3">type unit = Unit<br /><br />Full name: Microsoft.FSharp.Core.unit</div>
<div class="tip" id="fs4">val failwith : message:string -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.failwith</div>
<div class="tip" id="fs5">val now : unit -&gt; Time<br /><br />Full name: Tutorial.now</div>
<div class="tip" id="fs6">val time : &#39;a -&gt; Time<br /><br />Full name: Tutorial.time</div>
<div class="tip" id="fs7">val wait : (Time -&gt; unit)<br /><br />Full name: Tutorial.wait</div>
<div class="tip" id="fs8">val updateState : unit -&gt; unit<br /><br />Full name: Tutorial.updateState</div>
<div class="tip" id="fs9">val render : unit -&gt; unit<br /><br />Full name: Tutorial.render</div>
<div class="tip" id="fs10">val desiredDelay : Time<br /><br />Full name: Tutorial.desiredDelay</div>
<div class="tip" id="fs11">val startTime : Time</div>
<div class="tip" id="fs12">val diffTime : Time</div>
<div class="tip" id="fs13">val state : unit</div>

        </div>
        <div class="span3">
          <img src="/Freckle/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">Freckle</li>
            <li><a href="/Freckle/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/Freckle">Get Library via NuGet</a></li>
            <li><a href="http://github.com/jannickj/Freckle">Source Code on GitHub</a></li>
            <li><a href="/Freckle/license.html">License</a></li>
            <li><a href="/Freckle/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/Freckle/tutorial.html">Sample tutorial</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/Freckle/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/jannickj/Freckle"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
